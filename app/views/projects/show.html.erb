<div class="projects-info">
  <h1><%= @project.title %></h1>

  <div class="project-basics">
    <div class="project-image">
      <% if @project.image.present? %>
        <%= image_tag @project.image %>
      <% else %>
        <%= image_tag "chihuahua.jpg", alt:"doggie" %>
      <% end %>
    </div>

    <div class="project-info">
      <h3>Project Owner:
        <%= link_to @project.user.name.titleize, user_path(@project.user) %>
      </h3>

      <h3>Amount Pledged:
        $<%= @project.total_pledged_in_project %>
      </h3>

      <p><%= @project.description %></p>
      <p>Goal: <%= number_to_currency(@project.goal) %></p>
      <p>Fundraising starts: <%= @project.start_date.strftime("%A %b %d %Y") %></p>
      <p>Deadline: <%= @project.end_date.strftime("%A %b %d %Y") %></p>
    </div>

  </div>

  <%= form_for [@project, Pledge.new] do |f| %>
    <%= f.number_field :dollar_amount, value: @project.rewards.minimum(:dollar_amount), step: 0.01, class: 'input-num' %>
    <%= f.submit "Pledge", class: 'btn btn-outline-primary m-0' %>
  <% end %>

  <hr>

  <h2>Rewards</h2>
  <div class="project-rewards">
    <% @project.rewards.each do |reward| %>
      <div class="reward">
        <p><%= number_to_currency(reward.dollar_amount) %> | <%= reward.description %></p>

        <!-- Form not sending right data -->
        <%= form_for [@project, Claim.new] do |f| %>
          <!-- need to send data about which reward is the user claiming -->
          <%= f.hidden_field :reward_id, value: reward.id %>
          <%= f.submit "Claim Reward", class: 'btn btn-outline-primary m-0' %>

          <!-- can only see the remove reward if i am the project owner  -->
          <% if current_user == @project.user %>
            <%= link_to "Remove reward", project_reward_path(@project, reward), method: 'delete', class: 'btn btn-outline-danger m-0' %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="add-reward">
    <%= link_to "Add new reward", new_project_reward_path(@project), class: 'btn btn-outline-primary' %>
  </div>

  <% if current_user == @project.user %>
    <hr>

    <h2>Project Backers</h2>

    <div class="project-backers">
      <% @project.pledges.each do |pledge| %>
        <% if pledge.persisted? %>
          <div class="backer">
            <p>
              <%= pledge.user.name.titleize %> pledged $<%= pledge.dollar_amount %>
            </p>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <% if current_user && current_user.pledge_projects.any? %>
    <% if current_user.pledge_projects.where(id: @project.id).exists? %>
      <div class="comment-section">
        <h3> Leave a Comment </h3>
        <%= render 'comments/comment_form', project: @project, comment: @comment %>
      </div>

      <% if @project.comments.any? %>

      <hr/>
        <h2> Comments: </h2>
        <% @project.comments.each do |comment| %>
        <p class="text">On <%= comment.created_at.strftime('%a, %B %C, %G') %> <%= comment.user.name %> said:</p>
          <p class="text"><%= comment.text %></p>
          <%= link_to "Edit Comment", edit_project_comment_path(@project, comment), class: 'btn' %>
          <%= link_to "Delete Comment", project_comment_path(@project, comment), class: 'btn', method: :delete, data: {confirm: "Are you sure you want to delete this project"}  %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>




  <div class="update-section">
    <% if @project.updates.any? && @project.users.include?(current_user) %>
    <hr/>
      <h2> Updates: </h2>
      <% @updates.order(:created_at).reverse_order.each do |update| %>
        <p class="text"><%= update.created_at.strftime('%a, %B %C, %G') %>: <%= update.description %></p>

          <% if current_user == @project.user %>
            <%= link_to "Edit Update", edit_project_update_path(@project, update), class: 'btn' %>
            <%= link_to "Delete Update", project_update_path(@project, update), method: :delete, data: {confirm: "Are you sure you want to delete this update?"}, class: 'btn'  %>
          <% end %>
      <% end %>
    <% end %>

  </div>

  <% if current_user == @project.user %>


  <%= render 'updates/update_form', project: @project, update: @update %>
  <% end %>

</div>
